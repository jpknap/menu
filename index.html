<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="js/jquery-2.0.3.js"></script>
<script type="text/javascript" src="js/jquery.gomap-1.3.2.min.js"></script>
<style>
#map {
    width:700px;
    height: 400px;
    margin: 0 auto 0 auto;
}
</style>
	<script>

		$(document).ready(function(){
			initialize();
			$.getJSON('php/map21102013.php','',process_contatcs);
			var array =  new Array();
			function process_contatcs(data){


				$.each(data, function(name , info){
                    var lat = info.latitud;
                    var lon = info.longitud;
                    var nombre = info.nombre;
                    var id = nombre;
					TestMarker(lat, lon , nombre , id);

             
		      });
         }
    });

				

    // Standard google maps function
    function initialize() {
        var myLatlng = new google.maps.LatLng(-39.833372, -73.245341);
        var myOptions = {
            zoom: 11,
            center: myLatlng
        }
        map = new google.maps.Map(document.getElementById("map"), myOptions);

    }

    // Function for adding a marker to the page.
    var gmarkers = [];
    function addMarker(location,title,id) {
        marker = new google.maps.Marker({
            position: location,
            title: title,
            id: id,
            map: map
        });
        gmarkers.push(marker);
    }

    // Testing the addMarker function
    function TestMarker(lat ,longi , title ,id ) {
           marke = new google.maps.LatLng(lat, longi);
           addMarker(marke,title,id);
    }

	
    function coordenadasCiudad(){
        //var data=document.getElementById("buscaCiudad");
       var data = $("#buscaCiudad").val();

        //var ciudadJSON = JSON.stringify(data);
        //console.log(ciudadJSON);
 
        // Realizamos la petición al servidor
        $.post('php/getCoorCiudad.php', {ciudad:data},
        function(respuesta) {
            console.log(respuesta);
            //aqui hacer los cambios en interfaz

        }).error(
               function(){
               console.log('Error al ejecutar la petición');   
        });

    }
    function puntos_rest(item){
      
        for (i = 0; i<gmarkers.length; i++){
            gmarkers[i].setMap(null);
        }
        var res = $(item).val().split(",");         
         TestMarker(res[0],res[1], $(item).find(":selected").text() ,$(item).find(":selected").text() );

    }
	</script>

</head>
    <form role="form">
        <div class="form-group">
            <label for="buscaCiudad">Ciudad</label>
            <input type="Ciudad" class="form-control" id="buscaCiudad" placeholder="Ingrese la ciudad que desee revisar">
            <select id="rest" onchange="puntos_rest(this)"> 
                 <option value="-38.833372,-39.833372"  >Rest1</option>
                 <option value="-38.933372,-39.83337" >Rest2</option> 
            </select>   
        </div>
    </form>
    <button id="buscador" type="submit" class="btn btn-default" onclick= "coordenadasCiudad();">Buscar</button>
<body>

	<div id="map">
	</div>

</body>

</html>

